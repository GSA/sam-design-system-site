<p>The Autocomplete Multiselect component works similarly to the Autocomplete component. Any service directives created for the single select autocomplete component should also work seamlessly with the multiselect autocomplete.</p>
<p>The major difference between the two components in terms of code use is the lack of a config object and the type of the output.</p>
<p>The first major difference is that we removed the config object. Rather than using this, developers should directly use inputs and outputs on the component's html markup. Angular's change detection does not do deep checking, and this made it more difficult for some of our developers to use the components without workarounds. We hope to make the APIs for both components match in the future.</p>
<p>The second major difference comes from the output type. Since multiple values can be used for output, the data type is now an array. That also means you must initialize your model with an array when using this component. Also keep that in mind if you need to initialize the component with data, e.g., when the user is editing previously submitted data. You will need to make sure the values you provide to the component are members of an array.</p>
<h2>Working with Paginated Services</h2>
<p>The autocomplete multiselect supports working with services that use pagination to implement an infinite scroll effect. The component itself stores the values passed to it and removes duplicates. However, the developer using the component must track the pagination by search string herself.</p>
<p>The following class demonstrates how to setup pagination with the component. As with any autocomplete service, we start by implementing the AutocompleteService interface.</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ACTestService</span> <span class="token keyword">implements</span> <span class="token class-name">AutocompleteService</span>
</code></pre>
<p>The values in this component come from a private member property, but this could just as easily come from a service call. In that case, the developer would need to use Angular's @Injectable() decorator.</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">private</span> values<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">'Random'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">'Random'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">'Just some data'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">'Just some data'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<p>In this simple example, we use the property names start and end to track pagination; however, typically pagination properties are called offset and limit.</p>
<p>We initialize the start property to 0 to start at the beginning of the index. The end property indicates the last index in the array that should return from the results.</p>
<p>Finally, lastSearch is used to track the current filter string. When the string changes, the pagination should reset since the result list should be different.</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">private</span> start<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> end<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> lastSearch<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token function">setFetchMethod</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token operator">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre>
<p>The resetPagination method is used to reset the pagination variables back to their initial state when the searchString changes.</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">public</span> <span class="token function">resetPagination</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The fetch method from the AutocompleteService is where most of the magic happens. First, we check if the latest search string, val, is the same as the lastSearch. If not, we reset pagination.</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">public</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> pageEnd<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span> serviceOptions<span class="token operator">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastSearch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resetPagination</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Next, if the pageEnd parameter is true and val hasn't changed since the last search, increment the indices that are used for pagination. In this case, I also added a check that if the index is out of scope, return an empty array.</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">if</span> <span class="token punctuation">(</span>pageEnd <span class="token operator">&amp;&amp;</span> val <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastSearch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>end<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">></span> <span class="token keyword">this</span><span class="token punctuation">.</span>values<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Observable<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>lastSearch <span class="token operator">=</span> val<span class="token punctuation">;</span>
</code></pre>
<p>Finally, we call the filter method to return the sliced array with the correct indices.</p>
<pre class="language-typescript"><code class="language-typescript">    <span class="token operator">...</span>
    <span class="token keyword">return</span> Observable<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>start<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>end<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token function">filter</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>values<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token operator">||</span> value<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> value<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In an ideal world, most of this tracking will be done by an API call. However, this example serves to demonstrate the concerns that developers need to account for when implementing pagination on this component.</p>
<h3>Complete Service Code</h3>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ACTestService</span> <span class="token keyword">implements</span> <span class="token class-name">AutocompleteService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> values<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">'Random'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">'Random'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">'Just some data'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">'Just some data'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token operator">...</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
  
    <span class="token keyword">private</span> start<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> end<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> lastSearch<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  
    <span class="token keyword">public</span> <span class="token function">setFetchMethod</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token operator">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  
    <span class="token keyword">public</span> <span class="token function">resetPagination</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> pageEnd<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span> serviceOptions<span class="token operator">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastSearch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resetPagination</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>pageEnd <span class="token operator">&amp;&amp;</span> val <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastSearch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>end<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">></span> <span class="token keyword">this</span><span class="token punctuation">.</span>values<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> Observable<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  
      <span class="token keyword">this</span><span class="token punctuation">.</span>lastSearch <span class="token operator">=</span> val<span class="token punctuation">;</span>
      <span class="token keyword">return</span> Observable<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>start<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>end<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token keyword">private</span> <span class="token function">filter</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>values<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">||</span> value<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> value<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
